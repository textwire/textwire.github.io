"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7631],{6627:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"upgrade","title":"Upgrade Guide - v3","description":"Learn how to upgrade your Textwire code from v2 to v3","source":"@site/versioned_docs/version-v3/upgrade.md","sourceDirName":".","slug":"/upgrade","permalink":"/docs/v3/upgrade","draft":false,"unlisted":false,"tags":[],"version":"v3","sidebarPosition":7,"frontMatter":{"title":"Upgrade Guide - v3","sidebar_label":"Upgrade Guide","sidebar_position":7,"description":"Learn how to upgrade your Textwire code from v2 to v3"},"sidebar":"tutorialSidebar","previous":{"title":"FAQ","permalink":"/docs/v3/faq"}}');var r=i(4848),o=i(8453);const s={title:"Upgrade Guide - v3",sidebar_label:"Upgrade Guide",sidebar_position:7,description:"Learn how to upgrade your Textwire code from v2 to v3"},l="Upgrade Guide",a={},d=[{value:"Upgrading from v2 to v3",id:"upgrading-from-v2-to-v3",level:2},{value:"Quick Summary",id:"quick-summary",level:3},{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Steps",id:"steps",level:2},{value:"1. New Import Path",id:"1-new-import-path",level:3},{value:"2. Updating the Dependencies",id:"2-updating-the-dependencies",level:3},{value:"3. Minimal Go Version is 1.25",id:"3-minimal-go-version-is-125",level:3},{value:"4. Global Variable Conflict",id:"4-global-variable-conflict",level:3},{value:"5. Return Type for Custom Functions",id:"5-return-type-for-custom-functions",level:3},{value:"6. Precedence Change",id:"6-precedence-change",level:3},{value:"Understanding the Problem",id:"understanding-the-problem",level:4},{value:"New Precedence Behavior",id:"new-precedence-behavior",level:4},{value:"7. Changed Default file Extension",id:"7-changed-default-file-extension",level:3},{value:"1. Easy Solution",id:"1-easy-solution",level:4},{value:"2. A Long Term Solution",id:"2-a-long-term-solution",level:4},{value:"8. Components Scope Fix",id:"8-components-scope-fix",level:3},{value:"9. Variable Leak Fix",id:"9-variable-leak-fix",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"upgrade-guide",children:"Upgrade Guide"})}),"\n",(0,r.jsx)(n.h2,{id:"upgrading-from-v2-to-v3",children:"Upgrading from v2 to v3"}),"\n",(0,r.jsx)(n.h3,{id:"quick-summary",children:"Quick Summary"}),"\n",(0,r.jsx)(n.p,{children:"For experienced developers, here's the high-level overview:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Change import paths from ",(0,r.jsx)(n.code,{children:"v2"})," to ",(0,r.jsx)(n.code,{children:"v3"})]}),"\n",(0,r.jsx)(n.li,{children:"Update Go version requirement"}),"\n",(0,r.jsxs)(n.li,{children:["Rename any ",(0,r.jsx)(n.code,{children:"global"})," variables"]}),"\n",(0,r.jsxs)(n.li,{children:["Update custom function return types to ",(0,r.jsx)(n.code,{children:"any"})]}),"\n",(0,r.jsxs)(n.li,{children:["Update file extensions from ",(0,r.jsx)(n.code,{children:".tw.html"})," to ",(0,r.jsx)(n.code,{children:".tw"})," (optional)"]}),"\n",(0,r.jsx)(n.li,{children:"Function call precedence has changed for prefix expressions"}),"\n",(0,r.jsx)(n.li,{children:"Pass variables to components manually"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Going from version 2 to version 3 is a simple process but it does involve some breaking changes."}),"\n",(0,r.jsx)(n.p,{children:"The reason we are doing so many breaking changes in one release is because it's better to do them right now when we don't have lots of people using Textwire. This transition would be much harder with tens of thousands of users than hundreds of users. Thank you for choosing Textwire, we'll do the best job possible to give you the least painful transition experience with detailed guide."}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#1-new-import-path",children:"New Import Path"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#2-updating-the-dependencies",children:"Updating the Dependencies"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#3-minimal-go-version-is-125",children:"Minimal Go Version is 1.25"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#4-global-variable-conflict",children:"Global Variable Conflict"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#5-return-type-for-custom-functions",children:"Return Type for Custom Functions"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#6-precedence-change",children:"Precedence Change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#7-changed-default-file-extension",children:"Changed Default file Extension"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps below to upgrade your Textwire code to v3."}),"\n",(0,r.jsx)(n.h3,{id:"1-new-import-path",children:"1. New Import Path"}),"\n",(0,r.jsxs)(n.p,{children:["Change all the imports in your code from ",(0,r.jsx)(n.code,{children:"github.com/textwire/textwire/v2"})," to ",(0,r.jsx)(n.code,{children:"github.com/textwire/textwire/v3"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:'- import "github.com/textwire/textwire/v2"\n+ import "github.com/textwire/textwire/v3"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-updating-the-dependencies",children:"2. Updating the Dependencies"}),"\n",(0,r.jsxs)(n.p,{children:["Run the command ",(0,r.jsx)(n.code,{children:"go mod tidy"})," to update the dependencies in your ",(0,r.jsx)(n.code,{children:"go.mod"})," file"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Update Go module dependencies"',children:"go mod tidy\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-minimal-go-version-is-125",children:"3. Minimal Go Version is 1.25"}),"\n",(0,r.jsxs)(n.p,{children:["Make sure your Go version is ",(0,r.jsx)(n.code,{children:"1.25"})," or higher."]}),"\n",(0,r.jsx)(n.admonition,{title:"Breaking Change",type:"warning",children:(0,r.jsx)(n.p,{children:"Applications using Go versions below 1.25 will not work with Textwire v3."})}),"\n",(0,r.jsx)(n.h3,{id:"4-global-variable-conflict",children:"4. Global Variable Conflict"}),"\n",(0,r.jsxs)(n.p,{children:["If you have any defined variables called ",(0,r.jsx)(n.code,{children:"global"}),", rename it to something else because this variable is now reserved. You'll get an error if you are trying to use it."]}),"\n",(0,r.jsx)(n.admonition,{title:"Critical",type:"warning",children:(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"global"})," as a variable name will cause compilation errors in v3. This variable name is now reserved for internal use."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Recursively search files that contain the word global"',children:'grep -r "global" ./templates\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"./templates"})," with the path to your Textwire files. It will show you all the files that you need to modify. If you found any, prefix them with underscore like ",(0,r.jsx)(n.code,{children:"_global"})," and search for ",(0,r.jsx)(n.code,{children:'"global"'})," in your Go files, in the parts that pass that variable through to Textwire."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Search for global variable references in Go code"',children:"grep -r '\"global\"' ./internal\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"./internal"})," with the path to your Go code. If you found any values that you pass to Textwire, replace ",(0,r.jsx)(n.code,{children:'"global"'})," with ",(0,r.jsx)(n.code,{children:'"_global"'}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"5-return-type-for-custom-functions",children:"5. Return Type for Custom Functions"}),"\n",(0,r.jsxs)(n.p,{children:["In Textwire v2, custom functions would return the receiver type. For example, if you define a custom function for strings, it would return string. In Textwire v3, custom functions for all types return type ",(0,r.jsx)(n.code,{children:"any"}),", which is an alias to ",(0,r.jsx)(n.code,{children:"interface{}"}),". Check if you have custom functions defined in your Go code."]}),"\n",(0,r.jsx)(n.admonition,{title:"Breaking Change",type:"warning",children:(0,r.jsxs)(n.p,{children:["All custom functions must now return ",(0,r.jsx)(n.code,{children:"any"})," instead of their specific type. This affects ",(0,r.jsx)(n.code,{children:"RegisterStrFunc"}),", ",(0,r.jsx)(n.code,{children:"RegisterIntFunc"}),", ",(0,r.jsx)(n.code,{children:"RegisterBoolFunc"}),", ",(0,r.jsx)(n.code,{children:"RegisterFloatFunc"}),", and ",(0,r.jsx)(n.code,{children:"RegisterArrFunc"}),"."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Search for custom function registrations"',children:'grep -r -E "Register(Str|Int|Bool|Float|Arr)Func\\(" ./internal\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"./internal"})," with the path to your Go code. If you found any, just change the return type to any."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",metastring:'title="Update custom function return type"',children:'- err = textwire.RegisterStrFunc("_isCool", func(s string, args ...any) string {\n+ err = textwire.RegisterStrFunc("_isCool", func(s string, args ...any) any {\n    return s == "John Wick"\n})\n'})}),"\n",(0,r.jsx)(n.p,{children:"The behavior will not change, because your function will still return the same type as it was."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"6-precedence-change",children:"6. Precedence Change"}),"\n",(0,r.jsx)(n.h4,{id:"understanding-the-problem",children:"Understanding the Problem"}),"\n",(0,r.jsxs)(n.p,{children:["Textwire v2 has a wrong ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Order_of_operations",children:"precedence"})," for function call operations with prefix expressions. For example, operation like ",(0,r.jsx)(n.code,{children:'{{ !"aaa".contains("a") }}'})," would evaluate ",(0,r.jsx)(n.code,{children:'!"aaa"'})," first and cause an error because you cannot use ",(0,r.jsx)(n.code,{children:"!"})," operator on string."]}),"\n",(0,r.jsx)(n.h4,{id:"new-precedence-behavior",children:"New Precedence Behavior"}),"\n",(0,r.jsxs)(n.p,{children:["Textwire v3 puts higher precedence on function call and in code like this ",(0,r.jsx)(n.code,{children:'{{ !"aaa".contains("a") }}'})," it would first evaluate ",(0,r.jsx)(n.code,{children:'"aaa".contains("a")'})," and then apply ",(0,r.jsx)(n.code,{children:"!"})," operator. Check if you use the functions with prefix expressions like ",(0,r.jsx)(n.code,{children:"!"})," and ",(0,r.jsx)(n.code,{children:"-"})," and make sure they returns the result you expect."]}),"\n",(0,r.jsx)(n.p,{children:"Here is the command that will help you to find all functions that might be affected by this change. Only functions that return boolean, integer or float could be affected by this change. See if any of them have prefix."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Search for functions affected by precedence change"',children:'grep -r -E "\\.(contains|len|rand|abs|float|ceil|floor|int|binary|then)\\(" ./internal\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"./internal"})," with the path to your Go code."]}),"\n",(0,r.jsxs)(n.p,{children:["If you found something like ",(0,r.jsx)(n.code,{children:"{{ -numb.floor() }}"}),", you can fix it in two ways:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep the old behavior."})," To keep the old behavior just add parenthesis like this ",(0,r.jsx)(n.code,{children:"{{ (-numb).floor() }}"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"To get the correct behavior."})," To get the correct result, you don't need to change anything, just keep ",(0,r.jsx)(n.code,{children:"{{ -numb.floor() }}"}),". It will evaluate ",(0,r.jsx)(n.code,{children:"numb.floor()"})," first and then prepend ",(0,r.jsx)(n.code,{children:"-"})," sign to the result."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"7-changed-default-file-extension",children:"7. Changed Default file Extension"}),"\n",(0,r.jsxs)(n.p,{children:["Textwire v2 is using ",(0,r.jsx)(n.code,{children:".tw.html"})," file extension by default, in v3 this file default file extension was changed to ",(0,r.jsx)(n.code,{children:".tw"}),". If you use ",(0,r.jsx)(n.code,{children:".tw.html"})," for your Textwire files, you can resolve this in 2 ways:"]}),"\n",(0,r.jsx)(n.h4,{id:"1-easy-solution",children:"1. Easy Solution"}),"\n",(0,r.jsxs)(n.p,{children:["The easy solution would be to find your ",(0,r.jsx)(n.code,{children:"textwire.NewTemplate()"})," or ",(0,r.jsx)(n.code,{children:"textwire.Configure()"})," (depending on how you set configurations), and add ",(0,r.jsx)(n.code,{children:'TemplateExt: ".tw.html"'})," configuration like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="Configure template extension for v3 compatibility"',children:'tpl, err = textwire.NewTemplate(&config.Config{\n    TemplateExt: ".tw.html",\n})\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-a-long-term-solution",children:"2. A Long Term Solution"}),"\n",(0,r.jsxs)(n.p,{children:["Rename Textwire file extensions from ",(0,r.jsx)(n.code,{children:".tw.html"})," to ",(0,r.jsx)(n.code,{children:".tw"})," and make sure you don't have ",(0,r.jsx)(n.code,{children:"TemplateExt"})," configuration setup. In Textwire v3 ",(0,r.jsx)(n.code,{children:"TemplateExt"})," is set to ",(0,r.jsx)(n.code,{children:".tw"})," by default."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["You can set any extension for Textwire that you want, refer to ",(0,r.jsx)(n.a,{href:"/docs/v3/guides/configurations",children:"configurations"})," page for more details. But we recommend using ",(0,r.jsx)(n.code,{children:".tw"}),"."]})}),"\n",(0,r.jsx)(n.h3,{id:"8-components-scope-fix",children:"8. Components Scope Fix"}),"\n",(0,r.jsxs)(n.p,{children:["Components in ",(0,r.jsx)(n.strong,{children:"Textwire v2"})," would pass variables to their children automatially without manual passing. It was a bug. In ",(0,r.jsx)(n.strong,{children:"Textwire v3"})," each component has its scope. You need to pass data manually if you were using this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:"{{ name = \"Anna\" }}\n\n- @component('user')\n+ @component('user', { name })\n"})}),"\n",(0,r.jsx)(n.h3,{id:"9-variable-leak-fix",children:"9. Variable Leak Fix"}),"\n",(0,r.jsx)(n.p,{children:"Fixed variable leak from template to layout non-explicitly. In Textwire v2, if you had a variable in your template, it would be accessible in your layout without passing it explicitly. In Textwire v3, this is not available anymore."}),"\n",(0,r.jsxs)(n.p,{children:["If you were utilizing this behavior, you can fix it by using ",(0,r.jsx)(n.a,{href:"/docs/v3/guides/configurations#global-data",children:"Global Data"}),". Use it to pass variables into all of your Textwire files."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(6540);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);